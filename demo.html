<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SeqCoBench Sample Explorer</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />

    <!-- Favicon -->
    <link rel="icon" href="./static/images/favicon.svg" />

    <!-- Preconnect and Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">

    <!-- Bulma and Related CSS -->
    <link rel="stylesheet" href="./static/css/bulma.min.css">
    <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
    <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
    <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">

    <!-- Inline Styles -->
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      pre, code {
        padding: 0;
      }

      .container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        width: 100%;
      }

      .header, .buttons, .footer, .key {
        flex-shrink: 0;
      }

      .header {
        margin: 10px 0;
      }

      .footer {
        padding: 10px;
        font-size: 12px;
      }

      .scrollable-div {
        height: calc(100vh - 460px);
        overflow-y: auto;
        background-color: #f5f5f5;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid black;
      }

      .buttons {
        margin-top: 10px;
      }

      .btn {
        margin-bottom: 7px;
      }

      .left-col {
        width: 200px;
      }

      .left-half {
        width: 50%;
      }

      .left-align {
        text-align: left;
      }

      .table {
        background-color: #f5f5f5;
      }

      table tr,
      table td {
        border: none !important;
      }

      .bottom-border {
        border-bottom: 1px solid gray !important;
      }

      .generation {
        background-color: #3ebd66; /* default correct styling */
      }

      .generation.incorrect {
        background-color: rgb(255 187 187);
      }
    </style>

    <!-- jQuery (only once) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
    <!-- Deferred FontAwesome -->
    <script defer src="./static/js/fontawesome.all.min.js"></script>
    <script src="./static/js/bulma-carousel.min.js"></script>
    <script src="./static/js/bulma-slider.min.js"></script>
    <script src="./static/js/index.js"></script>
  </head>

  <body>
    <div id="content" class="container-fluid d-flex flex-column align-items-center gap-3">
      <h1 style="padding-top: 20px;" class="title is-1 publication-title">
        üõ†Ô∏è SeqCoBench Sample Explorer üõ†Ô∏è
      </h1>
      <h3 class="fw-light text-center title is-3">
        <small id="warning">
          SeqCoBench is a benchmark measuring code functional equivalence capabilities!<br>
        </small>
      </h3>

      <div class="column has-text-centered">
        <div class="publication-links">
          <span class="link-block">
            <a href="./index.html" class="external-link button is-normal is-rounded is-dark">
              <span class="icon"><i class="fas fa-home"></i></span>
              <span>Homepage</span>
            </a>
          </span>
          <span class="link-block">
            <a href="./paper/seqcobench.pdf" target="_blank" class="external-link button is-normal is-rounded is-dark">
              <span class="icon"><i class="fas fa-file-pdf"></i></span>
              <span>Paper</span>
            </a>
          </span>
          <span class="link-block">
            <a href="https://github.com/nickil21/seqcobench" class="external-link button is-normal is-rounded is-dark">
              <span class="icon"><i class="fab fa-github"></i></span>
              <span>Code</span>
            </a>
          </span>
          <span class="link-block">
            <a href="https://huggingface.co/datasets/nickil/seqcobench" class="external-link button is-normal is-rounded is-dark">
              <span class="icon"><i class="far fa-images"></i></span>
              <span>HF Dataset</span>
            </a>
          </span>
          <span class="link-block">
            <a href="./leaderboard.html" class="external-link button is-normal is-rounded is-dark">
              <span class="icon"><i class="fa fa-trophy"></i></span>
              <span>Leaderboard</span>
            </a>
          </span>
        </div>
      </div>

      <br>

      <div class="container">
        <!-- Scrollable Content Area -->
        <div class="scrollable-div">
          <table class="table">
            <tr>
              <td>
                <label for="models">model:</label>
                <select id="models" name="model-names">
                  <option value="codellama-34b">codellama-34b</option>
                  <option value="gpt-4-0613">gpt-4-0613</option>
                  <option value="gpt-3.5-turbo-0613">gpt-3.5-turbo-0613</option>
                </select>
                &nbsp;&nbsp;
                <label for="temps">temp:</label>
                <select id="temps" name="temps">
                  <option value="0.2">0.2</option>
                  <option value="0.8">0.8</option>
                </select>
              </td>
            </tr>
            <tr>
              <td>
                <div style="display: flex; gap: 20px;">
                  <div style="width: 450px;">
                    <b>Original Code</b>
                    <code class="python"><pre id="problem1"></pre></code>
                  </div>
                  <div style="width: 450px;">
                    <b>Transformed Code</b>
                    <code class="python"><pre id="problem2"></pre></code>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td class="left-half"><b>Transformation</b></td>
              <td id="transformation" class="left-align"></td>
            </tr>
            <tr>
              <td class="left-half"><b>Actual</b></td>
              <td id="actual" class="left-align"></td>
            </tr>
          </table>
        </div>

        <!-- Navigation Buttons -->
        <div class="navigation-buttons text-center mt-3">
          <button type="button" id="leftButton" class="btn btn-secondary">&lt;&lt;</button>
          <button type="button" id="randButton" class="btn btn-secondary">??</button>
          <button type="button" id="rightButton" class="btn btn-secondary">&gt;&gt;</button>
          <div class="mt-2">
            <span id="currentPage">1</span> / <span id="totalPages">4</span>
          </div>
        </div>

        <!-- Footer -->
        <div class="footer text-center mt-3">
          The site is inspired by and based on
          <a href="https://minerva-demo.github.io">Minerva sample explorer</a> and
          <a href="https://llemma-demo.github.io/">Llemma</a>. Thanks!
        </div>
      </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="seqcobench.js"></script>

    <!-- Inline Script -->
    <script>
      $(document).ready(function () {
        const searchParams = new URLSearchParams(window.location.search);
        let currentPage = searchParams.has("id") ? parseInt(searchParams.get("id"), 10) : 1;
        let currentModel = "codellama-34b";
        let currentTemp = "0.2";
        let totalPages = 800;
        let data = DATA; // Assumes DATA is defined elsewhere
        totalPages = data.length;
        $("#totalPages").text(totalPages);
        $("#currentPage").text(currentPage);
        updateData(currentPage);
        updateButtonStatus();

        function updateData(idx) {
          const dataIndex = idx - 1;
          $("#problem1").text(data[dataIndex]["original_code"]);
          $("#problem2").text(data[dataIndex]["transformed_code"]);
          $("#transformation").text(data[dataIndex]["transformation"]);
          $("#actual").html(data[dataIndex]["label"]);

          // Helper: get generation items based on the json structure
          function getGenerations(json) {
            const items = [];
            for (let i = 0; i < 10; i++) {
              const generationText = json['raw_generations'][`sample_${dataIndex}`][i];
              const isCorrect = json['raw_scored_generations'][`sample_${dataIndex}`][i];
              const statusClass = isCorrect ? "correct" : "incorrect";
              items.push(`<span class="generation ${statusClass}">${generationText}</span><br>`);
            }
            return items.join('');
          }

          fetch(`./evaluation_results/${currentModel}_temp${currentTemp}_input.json`)
            .then(response => response.json())
            .then(json => {
              $("#inputs").html(getGenerations(json));
            });
        }

        function updateModels() {
          const models = ["codellama-34b", "codellama-34b+cot"];
          const options = models.map(m => `<option value="${m}">${m}</option>`);
          $('#models').html(options);
        }
        updateModels();

        function updateButtonStatus() {
          $("#leftButton").prop("disabled", currentPage <= 1);
          $("#rightButton").prop("disabled", currentPage >= totalPages);
        }

        $("#leftButton").click(function () {
          if (currentPage > 1) {
            currentPage--;
            $("#currentPage").text(currentPage);
            updateData(currentPage);
            updateButtonStatus();
          }
        });

        $("#randButton").click(function () {
          currentPage = Math.floor(Math.random() * totalPages) + 1;
          $("#currentPage").text(currentPage);
          updateData(currentPage);
          updateButtonStatus();
        });

        $("#rightButton").click(function () {
          if (currentPage < totalPages) {
            currentPage++;
            $("#currentPage").text(currentPage);
            updateData(currentPage);
            updateButtonStatus();
          }
        });

        $(document).keydown(function (e) {
          if (e.which === 37 && currentPage > 1) { // left arrow key
            currentPage--;
          } else if (e.which === 39 && currentPage < totalPages) { // right arrow key
            currentPage++;
          } else {
            return; // for other keys, do nothing
          }
          $("#currentPage").text(currentPage);
          updateData(currentPage);
          updateButtonStatus();
          e.preventDefault();
        });

        $("#models").change(function(){
          currentModel = $(this).val();
          updateData(currentPage);
        });

        $("#temps").change(function(){
          currentTemp = $(this).val();
          updateData(currentPage);
        });
      });
    </script>
  </body>
</html>
